classdef essentialDSF
    %essentialDSF Given (A, B, C, D) determine P, Q and G

    properties
        A; B; C; D; P; Q; G;
    end

    methods
        function obj = essentialDSF(A, B, C, D)
            %essentialDSF Construct an instance of this class
            %   Store A, B, C and D, and then compute P and Q
            obj.A = A; obj.B = B; obj.C = C; obj.D = D;

            numExposed = size(C, 1);  % number of rows in C
            A11 = A(1:numExposed, 1:numExposed);
            A22 = A(numExposed+1:end, numExposed+1:end);
            A12 = A(1:numExposed, numExposed+1:end);
            A21 = A(numExposed+1:end, 1:numExposed);
            B1 = B(1:numExposed, :);
            B2 = B(numExposed+1:end, :);

            syms s;
            W = A11 + A12 * inv(s*eye(size(A22)) - A22) * A21;
            D = diag(diag(W));
            V = A12 * inv(s*eye(size(A22)) - A22) * B2 + B1;

            obj.Q = simplify(inv(s*eye(size(D)) - D) * (W - D));
            obj.P = simplify(inv(s*eye(size(D)) - D) * V);
            
            obj.G = simplify(inv(eye(size(obj.Q)) - obj.Q) * obj.P);
        end

    end
end