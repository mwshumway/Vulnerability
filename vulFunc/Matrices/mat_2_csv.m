function mat_2_csv(file_path, new_file_name)
%MAT_2_CSV Writes all variables in a .mat file to a csv

vars = load(file_path);
variable_names = fieldnames(vars);

var_name = variable_names{2};
var_data = vars.(var_name);
fid = fopen(new_file_name, 'w');
fprintf(fid, '\n');
fclose(fid);

writematrix(var_data, new_file_name);

for i=3:length(variable_names)
    fid = fopen(new_file_name, 'a');
    % Write a header with the variable name
    fprintf(fid, '\n');

    % Close the file to use high-level function
    fclose(fid);
    var_name = variable_names{i};
    var_data = vars.(var_name);
    writematrix(var_data, new_file_name, "WriteMode","append")
end

end